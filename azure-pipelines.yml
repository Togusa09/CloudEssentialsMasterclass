# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
- task: DotNetCoreCLI@2
  inputs:
    command: 'publish'
    publishWebProjects: true
    arguments: '--configuration $(buildConfiguration) -o $(Build.ArtifactStagingDirectory)/Output'
    workingDirectory: './source/MasterclassApp'

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'drop'
    publishLocation: 'Container'

# - task: AzureResourceManagerTemplateDeployment@3
#   inputs:
#     deploymentScope: 'Resource Group'
#     azureResourceManagerConnection: 'Visual Studio Professional(1)(a2f5932a-dc69-4389-a87a-8107f0983604)'
#     subscriptionId: 'a2f5932a-dc69-4389-a87a-8107f0983604'
#     action: 'Create Or Update Resource Group'
#     resourceGroupName: '$(ResourceGroup)'
#     location: 'East US'
#     templateLocation: 'Linked artifact'
#     csmFile: './scripts/environment.bicep'
#     deploymentMode: 'Incremental'
#     deploymentOutputs: 'outputStorageVar'